# Go-ID Service Single Deployment
# Deploys single Go-ID service instance

deployment:
  name: "go-id-service"
  version: "1.0"
  type: "single"
  environment: "dev"
  description: "Single Go-ID service instance"

artifact:
  type: "container"
  name: "go-id"
  version: "v1"
  source: "local"
  artifact_id: "GOID_V1"
  path: "/home/mustafa/telcobright-projects/orchestrix/images/containers/lxc/go-id/go-id-v.1/generated/artifact/go-id-v1.tar.gz"

targets:
  - server:
      host: "localhost"
      user: "mustafa"
      ssh_key: "~/.ssh/id_rsa"
    instances:
      - name: "go-id-main"
        params:
          container_type: "lxc"
          port: 7080
          memory: "128M"
          cpu: "1"
          env_vars:
            PORT: "7080"
            LOG_LEVEL: "INFO"
            DATA_DIR: "/data"

monitoring:
  health_check_url: "http://localhost:7080/health"
  startup_timeout: 30
  retry_count: 3

rollback:
  enabled: true
  keep_versions: 3
  auto_rollback_on_failure: true

post_deployment:
  scripts:
    - "sleep 5"
    - "curl -s http://localhost:7080/health"
  verify_commands:
    - command: "curl -s http://localhost:7080/api/ready | grep -q 'true'"
      description: "Verify service is ready"
    - command: "curl -s -X POST http://localhost:7080/api/entity -H 'Content-Type: application/json' -d '{\"entityName\":\"test\",\"entityId\":\"1\"}' | grep -q 'success'"
      description: "Test entity creation"
# Single Deployment Template
# For deploying one instance of an artifact on a single server

deployment:
  name: "${SERVICE_NAME}"
  version: "1.0"
  type: "single"
  environment: "${ENV}"
  description: "Single instance deployment"

artifact:
  type: "${ARTIFACT_TYPE}"  # binary|container
  name: "${ARTIFACT_NAME}"
  version: "${ARTIFACT_VERSION}"
  source: "database"
  artifact_id: "${DB_ARTIFACT_ID}"

targets:
  - server:
      host: "${TARGET_HOST}"
      user: "${DEPLOY_USER}"
      ssh_key: "${SSH_KEY_PATH}"
    instances:
      - name: "${INSTANCE_NAME}"
        params:
          port: ${PORT}
          memory: "${MEMORY_LIMIT}"
          cpu: "${CPU_LIMIT}"
          env_vars:
            NODE_ENV: "${ENV}"
            LOG_LEVEL: "INFO"

monitoring:
  health_check_url: "http://${TARGET_HOST}:${PORT}/health"
  startup_timeout: 60
  retry_count: 3

rollback:
  enabled: true
  keep_versions: 3
  auto_rollback_on_failure: true
# infinite-scheduler - LXC Deployment

Generated by quarkus-scaffold.sh

## Directory Structure

```
infinite-scheduler/
├── build/
│   ├── build.conf                    # Build configuration
│   └── build.sh                      # Build script (Maven + LXC image)
│
├── scripts/
│   ├── deploy.sh                     # Deployment script
│   └── new-deployment.sh             # Template (copied to deployments/)
│
└── infinite-scheduler-v{version}/           # Version-specific artifacts
    ├── generated/
    │   └── artifacts/
    │       ├── infinite-scheduler-{version}.jar
    │       └── infinite-scheduler-{version}.tar.gz
    │
    └── deployments/                  # Version-specific deployments
        ├── new-deployment.sh         # Create new deployment
        ├── link3-prod/
        │   ├── deployment.yaml
        │   └── application.properties
        └── link3-staging/
            ├── deployment.yaml
            └── application.properties
```

## Workflow

### 1. Build (Creates JAR + LXC Image)

```bash
cd build
./build.sh
```

This will:
- Run `mvn clean install -DskipTests`
- Copy JAR to artifacts/
- Create LXC container image
- Export to tarball

Output: `infinite-scheduler-v1.0.0/generated/artifacts/`

### 2. Create Deployment Configuration

```bash
cd infinite-scheduler-v1.0.0/deployments
./new-deployment.sh
```

Interactive prompts will create:
- `deployment.yaml` - Container configuration
- `application.properties` - Quarkus config (copied from Java project)

### 3. Customize Configuration

Edit the deployment-specific files:

```bash
vim <deployment-name>/application.properties
vim <deployment-name>/deployment.yaml
```

### 4. Deploy

```bash
cd ../..
./scripts/deploy.sh infinite-scheduler-v1.0.0/deployments/<deployment-name>
```

## Multiple Versions

Build multiple versions:

```bash
# Edit build.conf for v1.1.0
vim build/build.conf
# Update: APP_VERSION="1.1.0"
#         JAR_FILE=".../target/infinite-scheduler-1.1.0.jar"

# Build v1.1.0
cd build && ./build.sh

# Create v1.1.0 deployment
cd ../infinite-scheduler-v1.1.0/deployments
./new-deployment.sh
# Can copy from v1.0.0 deployment!

# Deploy v1.1.0
../../scripts/deploy.sh infinite-scheduler-v1.1.0/deployments/link3-prod-v1.1
```

## Configuration Override

Quarkus loads configuration in this order:

1. **Embedded** `application.properties` (in JAR) - Default values
2. **/opt/infinite-scheduler/config/application.properties** - Deployment-specific (OVERRIDES embedded)

The deployment script injects step 2, allowing same JAR for multiple environments.

## Key Features

✅ **One build, multiple deployments** - Same JAR, different configs
✅ **Version-specific deployments** - Each version has separate deployment folders
✅ **Config override** - Deployment properties override JAR defaults
✅ **Maven integration** - build.sh runs mvn clean install
✅ **Local or remote** - Deploy to local LXC or remote servers
✅ **Copy between versions** - Migrate configs from v1.0.0 to v1.1.0


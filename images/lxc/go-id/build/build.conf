#!/bin/bash
# Build configuration for Go ID Generator Container
# Follow Orchestrix container scaffolding standards

# ============================================
# BASE CONFIGURATION
# ============================================
BASE_IMAGE="debian-12"  # Using local cached image (faster builds)
CONTAINER_VERSION="1"
BUILD_TIMEOUT="1800"
CONTAINER_NAME_PREFIX="go-id"
BASE_PATH="/home/mustafa/telcobright-projects/orchestrix/images/lxc/go-id"

# ============================================
# STORAGE CONFIGURATION (MANDATORY)
# ============================================
STORAGE_PROVIDER="btrfs"
STORAGE_LOCATION_ID="btrfs_local_main"     # REQUIRED - Set your storage location
STORAGE_CONTAINER_ROOT="go-id"
STORAGE_QUOTA_SIZE="1G"                     # REQUIRED - Optimized for Go (minimal footprint)
STORAGE_COMPRESSION="true"
STORAGE_SNAPSHOT_ENABLED="true"
STORAGE_SNAPSHOT_FREQUENCY="daily"
STORAGE_SNAPSHOT_RETAIN="7"

# ============================================
# STORAGE MONITORING (MANDATORY)
# ============================================
STORAGE_MONITOR_ENABLED="true"
STORAGE_ROTATION_THRESHOLD="80"
STORAGE_FORCE_CLEANUP_THRESHOLD="90"
STORAGE_CHECK_INTERVAL="300"

# ============================================
# GO CONFIGURATION
# ============================================
GO_VERSION="1.21"                          # Go version to install

# ============================================
# SERVICE CONFIGURATION
# ============================================
SERVICE_PORT="7001"                        # ID generator API port
ENABLE_SSH="true"
SSH_AUTO_ACCEPT="true"

# ============================================
# RESOURCE LIMITS
# ============================================
MEMORY_LIMIT="512MB"                       # Less memory needed than Node.js
CPU_LIMIT="1"

# ============================================
# NETWORK CONFIGURATION
# ============================================
NETWORK_BRIDGE="lxdbr0"
NETWORK_IP=""                              # Empty for DHCP

# ============================================
# BUILD OPTIONS
# ============================================
CLEAN_BUILD="true"
EXPORT_CONTAINER="true"
CREATE_SNAPSHOT="true"
IMAGE_ALIAS="go-id-base"

# ============================================
# PUBLISH CONFIGURATION
# ============================================
RCLONE_REMOTE="gdrive"                     # Rclone remote name (configured via rclone config)
# Note: Target directory will mirror local structure: images/lxc/go-id/go-id-v.X/generated
GENERATE_UPLOAD_SCRIPT="true"              # Generate publish.sh script

# ============================================
# NOTES
# ============================================
# This Go-based ID generator is:
# - 80-90% smaller than Node.js version (5G vs 10G quota)
# - Better concurrency with goroutines
# - Faster execution and lower memory usage
# - Single compiled binary deployment

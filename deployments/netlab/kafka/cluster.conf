# Kafka + Zookeeper Cluster Configuration - Netlab Environment
# Master configuration for 3-node cluster deployment
# Following netlab networking guidelines with container subnet routing via BGP

# ============================================
# CLUSTER TOPOLOGY
# ============================================
# This config deploys:
# - 3 Zookeeper nodes (ensemble) in LXC containers
# - 3 Kafka brokers (cluster) in LXC containers
# - All containers use lxdbr0 with IPs in their respective subnets
# - BGP routing via FRR overlay network for cross-node connectivity

# ============================================
# SERVER DEFINITIONS
# ============================================
# Format: SERVER_n=host:sshPort:sshUser:sshPassword
# Note: Password stored in ../secrets/ssh-password.txt

SERVER_1=10.20.0.30:22:telcobright:PASSWORD_FROM_SECRETS
SERVER_2=10.20.0.31:22:telcobright:PASSWORD_FROM_SECRETS
SERVER_3=10.20.0.32:22:telcobright:PASSWORD_FROM_SECRETS

# Host IPs for SSH access (management network)
SERVER_1_MGMT_IP=10.20.0.30
SERVER_2_MGMT_IP=10.20.0.31
SERVER_3_MGMT_IP=10.20.0.32

# ============================================
# NETWORK CONFIGURATION
# ============================================
# Containers use lxdbr0 bridge with container subnets
# Cross-node connectivity via BGP-routed overlay (10.9.9.0/24)

# Container subnets (per node)
# Each node has its own /24 subnet announced via BGP
CONTAINER_SUBNET_NODE1=10.10.199.0/24
CONTAINER_SUBNET_NODE2=10.10.198.0/24
CONTAINER_SUBNET_NODE3=10.10.197.0/24

# Gateway IPs (lxdbr0 on each node)
GATEWAY_NODE1=10.10.199.1
GATEWAY_NODE2=10.10.198.1
GATEWAY_NODE3=10.10.197.1

# Overlay network (WireGuard mesh for BGP)
OVERLAY_NODE1=10.9.9.1
OVERLAY_NODE2=10.9.9.2
OVERLAY_NODE3=10.9.9.3

DNS_SERVERS=8.8.8.8,8.8.4.4

# ============================================
# ZOOKEEPER ENSEMBLE CONFIGURATION
# ============================================
# 3-node ensemble for quorum
# Each container gets static IP in its node's subnet

# Zookeeper Node 1 (netlab01 - container subnet 10.10.199.0/24)
ZK1_SERVER=SERVER_1
ZK1_CONTAINER_NAME=zookeeper-node-1
ZK1_CONTAINER_IP=10.10.199.10
ZK1_SERVER_ID=1
ZK1_CLIENT_PORT=2181
ZK1_PEER_PORT=2888
ZK1_LEADER_PORT=3888
ZK1_DATA_DIR=/data/zookeeper
ZK1_HEAP_OPTS=-Xms512M -Xmx512M

# Zookeeper Node 2 (netlab02 - container subnet 10.10.198.0/24)
ZK2_SERVER=SERVER_2
ZK2_CONTAINER_NAME=zookeeper-node-2
ZK2_CONTAINER_IP=10.10.198.10
ZK2_SERVER_ID=2
ZK2_CLIENT_PORT=2181
ZK2_PEER_PORT=2888
ZK2_LEADER_PORT=3888
ZK2_DATA_DIR=/data/zookeeper
ZK2_HEAP_OPTS=-Xms512M -Xmx512M

# Zookeeper Node 3 (netlab03 - container subnet 10.10.197.0/24)
ZK3_SERVER=SERVER_3
ZK3_CONTAINER_NAME=zookeeper-node-3
ZK3_CONTAINER_IP=10.10.197.10
ZK3_SERVER_ID=3
ZK3_CLIENT_PORT=2181
ZK3_PEER_PORT=2888
ZK3_LEADER_PORT=3888
ZK3_DATA_DIR=/data/zookeeper
ZK3_HEAP_OPTS=-Xms512M -Xmx512M

# Zookeeper Ensemble Configuration (using container IPs routed via BGP)
# Format: server.ID=IP:peerPort:leaderPort
ZK_SERVERS=server.1=10.10.199.10:2888:3888;server.2=10.10.198.10:2888:3888;server.3=10.10.197.10:2888:3888

# ============================================
# KAFKA CLUSTER CONFIGURATION
# ============================================
# 3 brokers connected to Zookeeper ensemble
# Container IPs reachable across nodes via BGP routing

# Kafka Broker 1 (netlab01 - container IP 10.10.199.20)
KAFKA1_SERVER=SERVER_1
KAFKA1_CONTAINER_NAME=kafka-broker-1
KAFKA1_CONTAINER_IP=10.10.199.20
KAFKA1_PORT=9092
KAFKA1_BROKER_ID=1
KAFKA1_ZOOKEEPER_CONNECT=10.10.199.10:2181,10.10.198.10:2181,10.10.197.10:2181/kafka
KAFKA1_LISTENERS=PLAINTEXT://0.0.0.0:9092
KAFKA1_ADVERTISED_LISTENERS=PLAINTEXT://10.10.199.20:9092
KAFKA1_LOG_DIRS=/data/kafka-logs
KAFKA1_HEAP_OPTS=-Xms1G -Xmx1G
KAFKA1_BTRFS_QUOTA=20G

# Kafka Broker 2 (netlab02 - container IP 10.10.198.20)
KAFKA2_SERVER=SERVER_2
KAFKA2_CONTAINER_NAME=kafka-broker-2
KAFKA2_CONTAINER_IP=10.10.198.20
KAFKA2_PORT=9092
KAFKA2_BROKER_ID=2
KAFKA2_ZOOKEEPER_CONNECT=10.10.199.10:2181,10.10.198.10:2181,10.10.197.10:2181/kafka
KAFKA2_LISTENERS=PLAINTEXT://0.0.0.0:9092
KAFKA2_ADVERTISED_LISTENERS=PLAINTEXT://10.10.198.20:9092
KAFKA2_LOG_DIRS=/data/kafka-logs
KAFKA2_HEAP_OPTS=-Xms1G -Xmx1G
KAFKA2_BTRFS_QUOTA=20G

# Kafka Broker 3 (netlab03 - container IP 10.10.197.20)
KAFKA3_SERVER=SERVER_3
KAFKA3_CONTAINER_NAME=kafka-broker-3
KAFKA3_CONTAINER_IP=10.10.197.20
KAFKA3_PORT=9092
KAFKA3_BROKER_ID=3
KAFKA3_ZOOKEEPER_CONNECT=10.10.199.10:2181,10.10.198.10:2181,10.10.197.10:2181/kafka
KAFKA3_LISTENERS=PLAINTEXT://0.0.0.0:9092
KAFKA3_ADVERTISED_LISTENERS=PLAINTEXT://10.10.197.20:9092
KAFKA3_LOG_DIRS=/data/kafka-logs
KAFKA3_HEAP_OPTS=-Xms1G -Xmx1G
KAFKA3_BTRFS_QUOTA=20G

# ============================================
# LXC IMAGE CONFIGURATION
# ============================================
ZOOKEEPER_BASE_IMAGE=zookeeper-base
KAFKA_BASE_IMAGE=kafka-base

# Local image paths (for upload if needed)
ZOOKEEPER_IMAGE_TAR=/home/mustafa/telcobright-projects/orchestrix/images/lxc/zookeeper/zookeeper-v.1/generated/artifact/zookeeper-v1-20251018_210529.tar.gz
KAFKA_IMAGE_TAR=/home/mustafa/telcobright-projects/orchestrix/images/lxc/kafka/kafka-v.1/generated/artifact/kafka-v1-20251018_204403.tar.gz

# ============================================
# DEPLOYMENT OPTIONS
# ============================================
AUTO_START=true
VERIFY_CLUSTER=true
CLEANUP_EXISTING=true
ORCHESTRIX_PATH=/home/telcobright/orchestrix

# ============================================
# NETWORK ROUTING (BGP via FRR)
# ============================================
# Prerequisites:
# - WireGuard overlay network (10.9.9.0/24) must be running
# - FRR BGP routing must be configured
# - Container subnets must be announced via BGP
#
# Verification:
# - sudo vtysh -c 'show ip bgp'  # Should show all 3 container subnets
# - ping 10.10.199.10  # From any node should reach zk-node-1
# - ping 10.10.198.10  # From any node should reach zk-node-2
# - ping 10.10.197.10  # From any node should reach zk-node-3

# ============================================
# CONNECTION STRINGS (Generated after deployment)
# ============================================
# ZOOKEEPER_CONNECT=10.10.199.10:2181,10.10.198.10:2181,10.10.197.10:2181/kafka
# KAFKA_BOOTSTRAP=10.10.199.20:9092,10.10.198.20:9092,10.10.197.20:9092
#
# These are accessible from:
# - All netlab nodes (via BGP routing)
# - VPN clients (link3, bdcom) connected via wg-overlay
# - Any container deployed in the netlab cluster

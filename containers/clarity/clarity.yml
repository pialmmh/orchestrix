# Clarity LXD Container Configuration
# Monitoring container with Prometheus and Grafana for Orchestrix

container:
  name: clarity
  image: debian/12
  type: monitoring
  
config:
  # Resource limits
  limits.cpu: "2"
  limits.memory: 2GB
  limits.memory.swap: "false"
  
  # Boot configuration
  boot.autostart: "true"
  boot.autostart.delay: "10"
  boot.autostart.priority: "100"
  
  # Security
  security.nesting: "false"
  security.privileged: "false"

devices:
  root:
    type: disk
    pool: default
    path: /
    size: 20GB
    
  eth0:
    type: nic
    network: lxdbr0
    name: eth0
    
  prometheus-data:
    type: disk
    source: /home/telcobright/app/orchestrix/data/prometheus
    path: /var/lib/prometheus
    
  grafana-data:
    type: disk
    source: /home/telcobright/app/orchestrix/data/grafana
    path: /var/lib/grafana
    
  config:
    type: disk
    source: /home/telcobright/app/orchestrix/config
    path: /etc/orchestrix

# Prometheus configuration
prometheus:
  version: "latest"
  port: 9090
  retention_time: "30d"
  retention_size: "10GB"
  scrape_interval: "15s"
  evaluation_interval: "15s"
  
  # Default targets to monitor
  targets:
    - job_name: "prometheus"
      static_configs:
        - targets: ["localhost:9090"]
    
    - job_name: "node-exporter"
      static_configs:
        - targets: ["localhost:9100"]
    
    - job_name: "orchestrix-mysql"
      static_configs:
        - targets: ["10.0.1.10:9104"]  # MySQL exporter if mysql container exists

# Grafana configuration
grafana:
  version: "latest"
  port: 3300
  admin_user: "admin"
  admin_password: "admin"
  allow_signup: false
  anonymous_enabled: false
  
  # Pre-configured datasources
  datasources:
    - name: "Prometheus"
      type: "prometheus"
      url: "http://localhost:9090"
      is_default: true

# Node exporter for system metrics
node_exporter:
  enabled: true
  port: 9100

# Network settings
network:
  dns:
    - 8.8.8.8
    - 8.8.4.4

# Backup settings
backup:
  enabled: true
  schedule: "0 3 * * *"  # 3 AM daily
  retention_days: 7
  path: /backup

# Environment-specific settings
environment: "development"